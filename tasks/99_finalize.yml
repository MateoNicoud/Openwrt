---

- name: Cancel scheduled rollback job (atrm)
  when: enable_rollback_atd | bool
  ansible.builtin.shell: |
    set -e
    if [ -f "{{ rollback_dir }}/rollback_job_id" ]; then
      JOB_ID="$(cat {{ rollback_dir }}/rollback_job_id)"
      atrm "$JOB_ID" || true
    else
      echo "No rollback job to cancel"
    fi
  args:
    executable: /bin/sh
  changed_when: false
